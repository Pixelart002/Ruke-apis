import axios from 'axios'; import Header from '../components/Header'; import { useEffect, useState } from 'react';
export default function Cart(){ const [cart,setCart] = useState({items:[]}); const token = typeof window !== 'undefined' ? localStorage.getItem('token') : null;
  useEffect(()=>{ if(!token) return; axios.get('/api/cart',{ headers: { Authorization: 'Bearer '+token } }).then(r=>setCart(r.data)).catch(()=>{}); }, [token]);
  const checkout = async ()=>{ const res = await axios.post('/api/orders/checkout', {}, { headers: { Authorization: 'Bearer '+token } }); if(res.data.payment && res.data.payment.client_secret){ alert('Payment required; integrate Stripe.js with client_secret') } else alert('Order placed') }
  return (<div><Header /><div className="container py-6"><h1 className="text-2xl font-bold mb-4">Your Cart</h1>{cart.items && cart.items.length ? cart.items.map(i=> (<div key={i.id} className="border-b py-2 flex items-center"><img src={(i.products && i.products.image_url)||'/placeholder.png'} className="h-16 w-16 object-cover mr-4" /><div className="flex-1"><div className="font-semibold">{i.products && i.products.title}</div><div>${i.products && i.products.price} x {i.quantity}</div></div><button className="text-red-600" onClick={async ()=>{ await axios.post('/api/cart/remove',{ item_id: i.id }, { headers: { Authorization: 'Bearer '+token } }); location.reload(); }}>Remove</button></div>)) : <div>Your cart is empty</div>}<div className="mt-6"><button className="bg-green-600 text-white px-4 py-2 rounded" onClick={checkout}>Checkout</button></div></div></div>) }
